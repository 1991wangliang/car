<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>car</title>
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.rotate.js" ></script>
    <script type="text/javascript" src="html2canvas.min.js" ></script>
    <style>
        .parking{
            position: absolute;
            top:10px;
            left:400px;
            background-color: #46a50c;
            width: 150px;
            height: 150px;
            z-index: 1;
        }
        .car{
            position:absolute;top: 500px;left: 500px;width: 100px;z-index: 2;
        }

    </style>
</head>
<body>
    <div id="view" style="position: relative;width: 800px;height: 800px;background-color: bisque">
    <div class="parking"></div>
    <img class="car" id="car" src="car.png" />
    </div>

    <div style="position: absolute;right:10px;top: 0px;" >
        <img  src="" id="img" width="300px" />
    </div>
    <input type="number" value="20" id="step" >
    <input type="number" value="0" id="direction" >


</body>

<script>

    document.onkeydown=function(event) {
        var e = event || window.event || arguments.callee.caller.arguments[0];
        move(e.keyCode);
        return true;
    };

    var direction = 0;


    function picture() {
        html2canvas(document.getElementById('view')).then( function(canvas) {
            var url = canvas.toDataURL();
            console.log(url);
            $("#img").attr("src", url);
        });
    }

    function move(code){
        picture();
        var car = $("#car");
        var step = $("#step").val();
        
        if(code==37){//←
            if(direction!=0){
                direction = 0;
                car.rotate({animateTo: direction,callback:function () {
                        picture();
                    }});
                $("#direction").val(direction);
                return true;
            }

            car.animate({left:'-='+step},code*10,function () {
                picture();
            });
        }
        if(code==39){//→
            if(direction!=180) {
                direction = 180;
                car.rotate({animateTo: direction,callback:function () {
                        picture();
                    }});
                $("#direction").val(direction);
                return true;
            }

            car.animate({left:'+='+step},code*10,function () {
                picture();
            });
        }

        if(code==38){//↑
            if(direction!=90) {
                direction = 90;
                car.rotate({animateTo: direction,callback:function () {
                        picture();
                    }});
                $("#direction").val(direction);
                return true;
            }

            car.animate({top:'-='+step},code*10,function () {
                picture();
            });
        }

        if(code==40){//↓
            if(direction!=270) {
                direction = 270;
                car.rotate({animateTo: direction,callback:function () {
                        picture();
                    }});
                $("#direction").val(direction);
                return true;
            }
            car.animate({top:'+='+step},code*10,function () {
                picture();
            });
        }

    }
    


</script>
</html>